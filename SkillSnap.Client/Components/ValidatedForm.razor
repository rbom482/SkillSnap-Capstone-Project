@using Microsoft.AspNetCore.Components.Forms

<EditForm Model="@Model" OnValidSubmit="@HandleValidSubmit" OnInvalidSubmit="@HandleInvalidSubmit">
    <DataAnnotationsValidator />
    <ValidationSummary class="validation-summary" />
    
    <div class="form-container @CssClass">
        @ChildContent
        
        <div class="form-actions">
            @if (ShowSubmitButton)
            {
                <button type="submit" class="btn btn-primary @SubmitButtonClass" disabled="@(IsSubmitting || !IsFormValid)">
                    @if (IsSubmitting)
                    {
                        <span class="spinner-border spinner-border-sm me-2" role="status"></span>
                        @SubmittingText
                    }
                    else
                    {
                        @SubmitButtonText
                    }
                </button>
            }
            
            @if (ShowCancelButton)
            {
                <button type="button" class="btn btn-secondary @CancelButtonClass" @onclick="HandleCancel" disabled="@IsSubmitting">
                    @CancelButtonText
                </button>
            }
        </div>
    </div>
</EditForm>

<style>
    .form-container {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .validation-summary {
        background-color: #f8d7da;
        border: 1px solid #f5c6cb;
        color: #721c24;
        padding: 0.75rem 1rem;
        border-radius: 0.375rem;
        margin-bottom: 1rem;
    }

    .validation-summary:empty {
        display: none;
    }

    .form-actions {
        display: flex;
        gap: 0.5rem;
        margin-top: 1rem;
    }

    .btn {
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: 0.375rem;
        cursor: pointer;
        font-size: 1rem;
        font-weight: 500;
        transition: all 0.2s ease;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        justify-content: center;
    }

    .btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
    }

    .btn-primary {
        background-color: #007bff;
        color: white;
    }

    .btn-primary:hover:not(:disabled) {
        background-color: #0056b3;
    }

    .btn-secondary {
        background-color: #6c757d;
        color: white;
    }

    .btn-secondary:hover:not(:disabled) {
        background-color: #545b62;
    }

    .spinner-border {
        width: 1rem;
        height: 1rem;
        border: 0.125rem solid currentColor;
        border-right-color: transparent;
        border-radius: 50%;
        animation: spinner-border 0.75s linear infinite;
    }

    .spinner-border-sm {
        width: 0.875rem;
        height: 0.875rem;
        border-width: 0.125rem;
    }

    .me-2 {
        margin-right: 0.5rem;
    }

    @@keyframes spinner-border {
        to {
            transform: rotate(360deg);
        }
    }
</style>

@code {
    [Parameter] public object Model { get; set; } = null!;
    [Parameter] public RenderFragment ChildContent { get; set; } = null!;
    [Parameter] public EventCallback<EditContext> OnValidSubmit { get; set; }
    [Parameter] public EventCallback<EditContext> OnInvalidSubmit { get; set; }
    [Parameter] public EventCallback OnCancel { get; set; }
    [Parameter] public string CssClass { get; set; } = "";
    [Parameter] public bool ShowSubmitButton { get; set; } = true;
    [Parameter] public bool ShowCancelButton { get; set; } = false;
    [Parameter] public string SubmitButtonText { get; set; } = "Submit";
    [Parameter] public string CancelButtonText { get; set; } = "Cancel";
    [Parameter] public string SubmittingText { get; set; } = "Submitting...";
    [Parameter] public string SubmitButtonClass { get; set; } = "";
    [Parameter] public string CancelButtonClass { get; set; } = "";
    [Parameter] public bool IsSubmitting { get; set; }
    [Parameter] public bool IsFormValid { get; set; } = true;

    private async Task HandleValidSubmit(EditContext context)
    {
        if (OnValidSubmit.HasDelegate)
        {
            await OnValidSubmit.InvokeAsync(context);
        }
    }

    private async Task HandleInvalidSubmit(EditContext context)
    {
        if (OnInvalidSubmit.HasDelegate)
        {
            await OnInvalidSubmit.InvokeAsync(context);
        }
    }

    private async Task HandleCancel()
    {
        if (OnCancel.HasDelegate)
        {
            await OnCancel.InvokeAsync();
        }
    }
}